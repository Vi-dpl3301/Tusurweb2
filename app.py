# -*- coding: utf-8 -*-
from flask import Flask, jsonify, request, render_template

app = Flask(__name__)
app.config['JSON_AS_ASCII'] = False

# Полные данные о фильмах с локальными обложками
movies = [
    {
        "id": 1,
        "title": "Начало",
        "duration": 148,
        "genre": "Научная фантастика, Триллер",
        "year": 2010,
        "director": "Кристофер Нолан",
        "actors": ["Леонардо ДиКаприо", "Джозеф Гордон-Левитт", "Эллен Пейдж", "Том Харди"],
        "description": "«Начало» — это захватывающий научно-фантастический триллер, который исследует границы человеческого сознания и реальности. Фильм рассказывает историю Дома Кобба, профессионального вора, который специализируется на проникновении в сны людей и краже их самых сокровенных мыслей. Однако его последнее задание — не кража, а внедрение идеи — оказывается самым сложным и опасным. Он должен проникнуть в глубины подсознания сына своего клиента и «засеять» там мысль, которая изменит его жизнь. В процессе Кобб сталкивается с собственными демонами, прошлым и потерянной семьей. Фильм мастерски сочетает сложную сюжетную структуру, визуальные эффекты и эмоциональную глубину. Каждый уровень сна имеет свои законы физики, что создаёт уникальную атмосферу и напряжение. «Начало» — это не просто история о ворах снов, это размышление о том, что такое реальность, как мы определяем себя и что значит быть человеком. Фильм получил множество наград, включая четыре «Оскара», и стал культовым благодаря своей интеллектуальной сложности и визуальному великолепию.",
        "cover_filename": "Начало.png"
    },
    {
        "id": 2,
        "title": "Интерстеллар",
        "duration": 169,
        "genre": "Научная фантастика, Приключения",
        "year": 2014,
        "director": "Кристофер Нолан",
        "actors": ["Мэттью Макконахи", "Энн Хэтэуэй", "Джессика Честейн", "Майкл Кейн"],
        "description": "«Интерстеллар» — это эпическая научно-фантастическая драма, которая отправляет зрителя в путешествие сквозь время и пространство в поисках нового дома для человечества. Фильм начинается в ближайшем будущем, когда Земля находится на грани экологической катастрофы. Бывший пилот NASA Купер, живущий на ферме с детьми, случайно обнаруживает секретную миссию по спасению человечества. Ему предстоит возглавить экспедицию через червоточину в далекую часть галактики, чтобы найти пригодную для жизни планету. На пути он столкнется с испытаниями, которые проверят его на прочность: от гравитационных аномалий до потери времени и связи с домом. Фильм затрагивает темы любви, жертвенности и надежды, показывая, что даже в безнадежной ситуации человек способен совершать невозможное ради тех, кого любит. «Интерстеллар» — это не просто космическая одиссея, это глубокое размышление о человеческой природе, времени и месте человека во Вселенной. Визуальные эффекты, музыка Ханса Циммера и мощная актерская игра делают этот фильм одним из лучших в жанре.",
        "cover_filename": "Интерстеллар.png"
    },
    {
        "id": 3,
        "title": "Терминатор 2",
        "duration": 137,
        "genre": "Научная фантастика, Боевик",
        "year": 1991,
        "director": "Джеймс Кэмерон",
        "actors": ["Арнольд Шварценеггер", "Линда Хэмилтон", "Эдвард Фурлонг", "Роберт Патрик"],
        "description": "«Терминатор 2: Судный день» — это культовый научно-фантастический боевик, который стал эталоном для всех последующих фильмов в жанре. Действие происходит в 1995 году, спустя десять лет после событий первого фильма. Молодой Джон Коннор, будущий лидер Сопротивления против машин, становится целью нового, более совершенного терминатора — T-1000, способного менять форму. Чтобы защитить его, в прошлое отправляется модифицированный Т-800, которого играет Арнольд Шварценеггер. Этот робот, некогда убийца, теперь — защитник. Между ними завязывается напряженная борьба, в которой решается судьба человечества. Фильм сочетает в себе высокотехнологичные спецэффекты, динамичные сцены погонь и стрельбы, а также глубокие философские вопросы: что значит быть человеком? Можно ли изменить будущее? Какова роль технологий в жизни общества? «Терминатор 2» не только развлекает, но и заставляет задуматься. Его визуальные эффекты были революционными для своего времени, а образ Т-1000 до сих пор считается одним из самых пугающих в кино. Это фильм, который стоит посмотреть каждому поклоннику научной фантастики и боевиков.",
        "cover_filename": "Терминатор 2.png"
    },
    {
        "id": 4,
        "title": "Побег из Шоушенка",
        "duration": 142,
        "genre": "Драма",
        "year": 1994,
        "director": "Фрэнк Дарабонт",
        "actors": ["Тим Роббинс", "Морган Фриман", "Боб Гантон", "Уильям Сэдлер"],
        "description": "«Побег из Шоушенка» — это одна из самых трогательных и вдохновляющих драм в истории кино. Фильм рассказывает историю Энди Дюфрейна, банкира, осужденного пожизненно за убийство жены и ее любовника, хотя он утверждает, что невиновен. В тюрьме Шоушенк он встречает Реда, старого заключенного, который знает все ходы и выходы. Несмотря на жестокость системы и постоянные унижения, Энди не теряет надежду. Он использует свой ум и знания, чтобы помочь другим заключенным и даже тюремному начальству, тем самым завоевывая уважение и влияние. Но главное — он строит план побега, который занимает годы. Фильм — это история о силе духа, дружбе, справедливости и надежде. Он показывает, что даже в самых мрачных местах можно найти свет. «Побег из Шоушенка» получил множество наград и номинаций, включая семь «Оскаров». Он регулярно входит в топ-10 лучших фильмов по версии IMDb и других рейтингов. Это фильм, который стоит посмотреть каждому — он меняет взгляд на жизнь и дает силы бороться с трудностями.",
        "cover_filename": "Побег из Шоушенка.png"
    },
    {
        "id": 5,
        "title": "Крёстный отец",
        "duration": 175,
        "genre": "Криминал, Драма",
        "year": 1972,
        "director": "Фрэнсис Форд Коппола",
        "actors": ["Марлон Брандо", "Аль Пачино", "Джеймс Кэйн", "Роберт Дюваль"],
        "description": "«Крёстный отец» — это классический криминальный эпос, который изменил представление о жанре гангстерского кино. Фильм рассказывает историю семьи Корлеоне, одной из самых могущественных мафиозных семей в Америке. В центре сюжета — Вито Корлеоне, «крёстный отец», который управляет своим бизнесом с железной рукой, но при этом ценит семью и честь. Когда его сын Майкл, вначале далекий от дел семьи, вынужден вступить в игру, он превращается из мирного человека в холодного и расчетливого преступника. Фильм исследует темы власти, предательства, долга и цены, которую платят за успех. Каждая сцена, каждый диалог продуманы до мелочей. Актерская игра Марлона Брандо и Аль Пачино стала легендарной. Музыка Нино Роты, операторская работа и режиссура Копполы создают атмосферу, в которую погружаешься полностью. «Крёстный отец» получил три «Оскара», включая лучший фильм года, и до сих пор считается одним из лучших фильмов в истории. Это не просто история о мафии — это история о человеческой природе, о том, как власть меняет людей и как легко потерять себя, стремясь к успеху.",
        "cover_filename": "Крёстный отец.png"
    },
    {
        "id": 6,
        "title": "Властелин колец: Возвращение короля",
        "duration": 201,
        "genre": "Фэнтези, Приключения",
        "year": 2003,
        "director": "Питер Джексон",
        "actors": ["Эlijah Вуд", "Вигго Мортенсен", "Иэн Маккеллен", "Лив Тайлер"],
        "description": "«Властелин колец: Возвращение короля» — это эпический финал трилогии, который завершает одну из самых масштабных и захватывающих историй в кино. Фильм продолжает приключения Фродо, Сэма, Гэндальфа, Арагорна и других героев, которые пытаются уничтожить Кольцо Всевластья и победить Саурона. В этой части зритель видит грандиозные битвы, такие как битва за Минас Тирит, а также внутреннюю борьбу героев. Фродо и Сэм приближаются к Оrodruin, но сила Кольца становится все сильнее, и Фродо начинает сомневаться в себе. Арагорн, наконец, принимает свою судьбу и становится королем Гондора. Фильм сочетает в себе визуальные эффекты мирового уровня, мощную музыку Говарда Шора, глубокую драму и героизм. Он получил 11 «Оскаров» из 11 номинаций, включая лучший фильм года. «Возвращение короля» — это не просто фэнтези, это история о жертвенности, дружбе, надежде и победе добра над злом. Это фильм, который стоит посмотреть в кинотеатре или на большом экране, чтобы ощутить всю его мощь и красоту.",
        "cover_filename": "Властелин колец. Возвращение короля.png"
    },
    {
        "id": 7,
        "title": "Аватар",
        "duration": 162,
        "genre": "Научная фантастика, Приключения",
        "year": 2009,
        "director": "Джеймс Кэмерон",
        "actors": ["Сэм Уортингтон", "Зои Салдана", "Сигурни Уивер", "Стивен Лэнг"],
        "description": "«Аватар» — это революционный научно-фантастический фильм, который изменил киноиндустрию своими визуальными эффектами и использованием 3D-технологий. Действие происходит в 2154 году на планете Пандора, где корпорация «Рdale» добывает редкий минерал, угрожая экосистеме и местному населению — народу На’ви. Главный герой, Джейк Салли, бывший морской пехотинец, получает возможность управлять аватаром — гибридным телом, соединяющим его с телом На’ви. По мере того как он погружается в культуру и природу Пандоры, он начинает сомневаться в миссии корпорации и встает на сторону На’ви. Фильм — это история о конфликте между технологиями и природой, о том, как важно уважать другие культуры и экосистемы. Визуальные эффекты, созданные с помощью motion capture и CGI, были беспрецедентны для своего времени. Музыка Джеймса Хорнера и дизайн мира Пандоры создают незабываемую атмосферу. «Аватар» стал самым кассовым фильмом в истории (до выхода «Аватара 2») и получил три «Оскара». Это фильм, который стоит посмотреть каждому — он не только развлекает, но и заставляет задуматься о нашем отношении к окружающему миру.",
        "cover_filename": "Аватар.png"
    },
    {
        "id": 8,
        "title": "Гладиатор",
        "duration": 155,
        "genre": "Исторический, Драма",
        "year": 2000,
        "director": "Ридли Скотт",
        "actors": ["Рассел Кроу", "Хоакин Феникс", "Конни Нильсен", "Ричард Харрис"],
        "description": "«Гладиатор» — это эпическая историческая драма, которая переносит зрителя в Древний Рим. Фильм рассказывает историю Максимуса Децимуса Мериды, выдающегося римского генерала, чья жизнь рушится, когда император Марк Аврелий предлагает ему стать преемником, а его сын Коммод, завидуя, убивает отца и приказывает казнить Максимуса. Уцелевший, Максимус становится рабом, а затем гладиатором, чья цель — отомстить Коммоду. Фильм сочетает в себе масштабные боевые сцены, глубокую драму и философские размышления о чести, мести и свободе. Рассел Кроу блестяще играет главную роль, передавая боль, гнев и решимость героя. Режиссура Ридли Скотта, музыка Ханса Циммера и визуальные эффекты создают атмосферу древнего Рима, в которую погружаешься полностью. «Гладиатор» получил пять «Оскаров», включая лучший фильм года, и стал культовым. Это фильм, который стоит посмотреть каждому — он вдохновляет, заставляет сопереживать и задумываться о том, что значит быть человеком в мире, где власть и насилие правят бал.",
        "cover_filename": "Гладиатор.png"
    },
    {
        "id": 9,
        "title": "Бойцовский клуб",
        "duration": 139,
        "genre": "Триллер, Драма",
        "year": 1999,
        "director": "Дэвид Финчер",
        "actors": ["Эдвард Нортон", "Брэд Питт", "Хелена Бонэм Картер", "Митч Пилегги"],
        "description": "«Бойцовский клуб» — это провокационный психологический триллер, который исследует темы потребительства, мужской идентичности и бунта против общества. Фильм рассказывает историю анонимного рассказчика, работника офиса, который страдает от бессонницы и чувствует себя потерянным в мире рекламы и вещей. Он встречает Тайлера Дёрдена — харизматичного, хаотичного и опасного человека, который убеждает его создать «Бойцовский клуб» — место, где мужчины могут биться, чтобы почувствовать себя живыми. По мере развития клуба превращается в движение, которое хочет разрушить систему. Фильм — это размышление о том, что значит быть мужчиной в современном мире, о том, как общество формирует наши желания и как легко потерять себя в потребительском раю. Дэвид Финчер мастерски создает мрачную, гипнотическую атмосферу, а актерская игра Эдварда Нортона и Брэда Питта стала легендарной. Фильм получил множество наград и номинаций, включая «Оскар» за лучший звуковой монтаж. Это фильм, который стоит посмотреть каждому — он шокирует, заставляет задуматься и не оставляет равнодушным.",
        "cover_filename": "Бойцовский клуб.png"
    },
    {
        "id": 10,
        "title": "Титаник",
        "duration": 195,
        "genre": "Мелодрама, Исторический",
        "year": 1997,
        "director": "Джеймс Кэмерон",
        "actors": ["Леонардо ДиКаприо", "Кейт Уинслет", "Билли Зейн", "Кэти Бейтс"],
        "description": "«Титаник» — это эпическая мелодрама, основанная на реальных событиях, которая рассказывает историю любви на фоне одной из самых известных морских катастроф в истории. Фильм начинается в 1996 году, когда исследователи ищут сокровища на обломках «Титаника». Они находят рисунок молодой женщины, и начинается рассказ о её жизни. В 1912 году на борту «Титаника» встречаются Джек Дозье, бедный художник, и Роза Дьюитт Букейтер, богатая девушка, которая устала от своего окружения. Их любовь развивается на фоне роскоши и трагедии. Когда корабль сталкивается с айсбергом, их отношения проходят испытание на прочность. Фильм сочетает в себе романтику, драму, историческую достоверность и визуальные эффекты мирового уровня. Музыка Синди Лаупер и Джеймса Хорнера, особенно песня «My Heart Will Go On», стала символом эпохи. «Титаник» получил 11 «Оскаров» и стал самым кассовым фильмом в истории на тот момент. Это фильм, который стоит посмотреть каждому — он трогает сердце, заставляет сопереживать и напоминает, что любовь может быть сильнее смерти.",
        "cover_filename": "Титаник.png"
    }
]

# Эндпоинт: Главная страница (список фильмов)
@app.route('/')
def index():
    return render_template('index.html', movies=movies)

# Эндпоинт: Страница фильма
@app.route('/movies/<int:movie_id>')
def movie_page(movie_id):
    movie = next((m for m in movies if m['id'] == movie_id), None)
    if movie:
        return render_template('movie.html', movie=movie)
    else:
        return "<h1>Фильм не найден</h1><a href='/'>Назад к списку</a>", 404

# Эндпоинт: Получить все фильмы (API)
@app.route('/api/movies', methods=['GET'])
def get_movies():
    return jsonify(movies)

# Эндпоинт: Получить фильм по ID (API)
@app.route('/api/movies/<int:movie_id>', methods=['GET'])
def get_movie(movie_id):
    movie = next((m for m in movies if m['id'] == movie_id), None)
    if movie:
        return jsonify(movie)
    else:
        return jsonify({"error": "Фильм не найден"}), 404

# Эндпоинт: Добавить новый фильм (API)
@app.route('/api/movies', methods=['POST'])
def add_movie():
    new_movie = request.get_json()
    required_fields = ['title', 'duration', 'genre', 'year', 'director', 'actors', 'description', 'cover_filename']
    if not new_movie or not all(field in new_movie for field in required_fields):
        return jsonify({
            "error": "Неверные данные",
            "required": required_fields
        }), 400
    new_movie['id'] = max([m['id'] for m in movies], default=0) + 1
    movies.append(new_movie)
    return jsonify(new_movie), 201

# Эндпоинт: Обновить фильм (API)
@app.route('/api/movies/<int:movie_id>', methods=['PUT'])
def update_movie(movie_id):
    movie = next((m for m in movies if m['id'] == movie_id), None)
    if not movie:
        return jsonify({"error": "Фильм не найден"}), 404
    data = request.get_json()
    movie.update(data)
    return jsonify(movie)

# Эндпоинт: Удалить фильм (API)
@app.route('/api/movies/<int:movie_id>', methods=['DELETE'])
def delete_movie(movie_id):
    global movies
    movies = [m for m in movies if m['id'] != movie_id]
    return jsonify({"message": "Фильм удален"}), 200

if __name__ == '__main__':
    app.run(host='127.0.0.1', port=5000, debug=True)